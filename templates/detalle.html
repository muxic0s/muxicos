<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ curso[1] }} - Muxicos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lite-youtube-embed@0.3.3/src/lite-yt-embed.css" />
    <script src="https://cdn.jsdelivr.net/npm/lite-youtube-embed@0.3.3/src/lite-yt-embed.js"></script>

    <style>
        /* Estilos Base */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #111; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #555; }

        /* Lite Youtube Custom */
        lite-youtube {
            border-radius: 1rem;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            max-width: 100%;
            background-color: #000;
            z-index: 10;
            position: relative;
        }

        /* Animaciones */
        @keyframes heartPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        .heart-anim { animation: heartPulse 0.3s ease-in-out; }
    </style>
</head>
<body class="bg-[#0a0a0a] text-white font-sans h-screen flex overflow-hidden">

    {% include 'sidebar.html' %}

    <main class="flex-1 overflow-y-auto bg-[#0a0a0a] p-6 lg:p-8 grid grid-cols-1 lg:grid-cols-3 gap-8 no-scrollbar w-full relative">
        
        <div class="col-span-full flex justify-between items-center mb-2 z-20">
            <div class="text-xs text-gray-400 flex items-center gap-2 font-medium">
                <a href="/cursos" class="hover:text-white transition">Cursos</a> <span>/</span> 
                <span class="text-gray-300">{{ curso[5] }}</span> <span>/</span> 
                <span class="text-green-400 flex items-center gap-1">
                    <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span> Reproduciendo
                </span>
            </div>
            {% include 'user_menu.html' %}
        </div>
        
        <div class="lg:col-span-2 space-y-8">
            
            <div class="relative group w-full">
                <div class="absolute -inset-1 bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 rounded-2xl blur-xl opacity-20 group-hover:opacity-40 transition duration-1000 group-hover:duration-200"></div>
                
                <lite-youtube videoid="{{ video_id }}" 
                              playlabel="Reproducir: {{ curso[1] }}"
                              class="w-full aspect-video shadow-2xl relative z-10">
                </lite-youtube>
            </div>

            <div class="flex flex-col md:flex-row justify-between items-start border-b border-gray-800 pb-6 gap-4">
                
                <div class="flex-1">
                    <h2 class="text-2xl lg:text-3xl font-bold mb-4 text-white tracking-tight leading-tight">{{ curso[1] }}</h2>
                    <div class="flex items-center gap-3">
                         {% if curso[6] %} 
                            <img src="{{ curso[6] }}" class="w-10 h-10 rounded-full object-cover ring-2 ring-[#1E1E1E]" alt="{{ curso[5] }}">
                         {% else %}
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-gray-700 to-gray-900 flex items-center justify-center text-xs font-bold text-white ring-2 ring-[#1E1E1E]">
                                {{ curso[5][0] | upper }}
                            </div>
                         {% endif %}
                         <div>
                             <p class="text-sm font-bold text-white flex items-center gap-1 cursor-pointer hover:text-green-400 transition">
                                 {{ curso[5] }}
                                 <svg class="w-3 h-3 text-blue-400 fill-current" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                             </p>
                             <p class="text-[10px] text-gray-500 uppercase tracking-wide">Instructor Verificado</p>
                         </div>
                    </div>
                </div>
                
                <div class="flex items-center gap-2">
                    <button id="favBtn" onclick="toggleFavorite({{ curso[0] }})"
                            class="flex items-center gap-2 px-4 py-2 rounded-full transition-all duration-300 font-medium text-sm {{ 'text-red-500 bg-red-500/10' if es_favorito else 'bg-[#1E1E1E] text-gray-300 hover:bg-[#2A2A2A] hover:text-white' }}">
                        <svg id="favIcon" class="w-5 h-5 {{ 'fill-current' if es_favorito else 'fill-none stroke-current' }}" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                        <span class="hidden md:inline">Me gusta</span>
                    </button>

                    <button onclick="openModal('shareModal')" class="flex items-center gap-2 bg-[#1E1E1E] text-gray-300 hover:bg-[#2A2A2A] hover:text-white px-4 py-2 rounded-full transition font-medium text-sm">
                        <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M16 11h5l-9 10-9-10h5v-11h8v11zm1 11h-10v2h10v-2z"/></svg>
                        <span class="hidden md:inline">Compartir</span>
                    </button>

                    <button onclick="openModal('playlistModal')" class="flex items-center gap-2 bg-[#1E1E1E] text-gray-300 hover:bg-[#2A2A2A] hover:text-white px-4 py-2 rounded-full transition font-medium text-sm">
                        <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                        <span class="hidden md:inline">Guardar</span>
                    </button>
                </div>
            </div>

            <div class="bg-[#161616] p-6 rounded-2xl border border-gray-800/50 hover:border-gray-700 transition">
                <h3 class="font-bold text-white mb-3 text-sm flex items-center gap-2 text-gray-300">
                    <span>üìù</span> Acerca de esta lecci√≥n
                </h3>
                <div class="text-sm text-gray-400 leading-relaxed whitespace-pre-wrap font-sans max-h-60 overflow-y-auto custom-scroll pr-2">
                    {{ curso[4].split('[SYSTEM_TAGS]')[0] }}
                </div>
            </div>

        </div>

        <div class="lg:col-span-1 flex flex-col h-full">
            <div class="bg-[#161616] rounded-xl border border-gray-800 overflow-hidden flex flex-col h-full max-h-[calc(100vh-100px)] sticky top-6">
                <div class="p-4 border-b border-gray-800 bg-[#1A1A1A] flex justify-between items-center shadow-lg z-10">
                    <h3 class="font-bold text-sm text-white">Siguientes lecciones</h3>
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] text-gray-400">Autoplay</span>
                        <div class="w-8 h-4 bg-green-500/20 rounded-full relative cursor-pointer"><div class="absolute right-0.5 top-0.5 w-3 h-3 bg-green-500 rounded-full shadow"></div></div>
                    </div>
                </div>
                
                <div class="overflow-y-auto custom-scroll flex-1 p-2 space-y-1">
                    <div class="p-2 flex gap-3 bg-[#252525] rounded-lg border border-gray-700/50">
                        <div class="relative w-24 h-14 flex-shrink-0 rounded overflow-hidden">
                            <img src="https://img.youtube.com/vi/{{ video_id }}/default.jpg" class="w-full h-full object-cover opacity-60">
                            <div class="absolute inset-0 bg-black/40 flex items-center justify-center">
                                <span class="text-green-500 text-xs animate-pulse">Playing</span>
                            </div>
                        </div>
                        <div class="flex flex-col justify-center">
                            <p class="text-xs font-bold text-white line-clamp-2 leading-tight">{{ curso[1] }}</p>
                            <p class="text-[10px] text-green-400 mt-1 font-medium">Reproduciendo...</p>
                        </div>
                    </div>

                    {% for sugerencia in sugerencias %}
                    <a href="/curso/{{ sugerencia[0] }}" class="p-2 flex gap-3 hover:bg-[#222] rounded-lg transition group border border-transparent hover:border-gray-800">
                        <div class="w-24 h-14 bg-gray-800 rounded overflow-hidden flex-shrink-0 relative group-hover:ring-1 ring-gray-600">
                            <img src="{{ sugerencia[3] }}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500 opacity-80 group-hover:opacity-100">
                            <span class="absolute bottom-1 right-1 bg-black/80 text-[9px] text-white px-1 rounded font-mono">10:05</span>
                        </div>
                        <div class="flex-1 min-w-0 flex flex-col justify-center">
                            <p class="text-xs font-medium text-gray-400 group-hover:text-white line-clamp-2 leading-snug transition">{{ sugerencia[1] }}</p>
                            <p class="text-[10px] text-gray-600 mt-0.5 truncate">{{ sugerencia[5] }}</p>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </main>

    <div id="shareModal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onclick="closeModal('shareModal')"></div>
        <div class="relative bg-[#1A1A1A] border border-gray-700 rounded-2xl w-full max-w-md p-6 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-white">Compartir</h3>
                <button onclick="closeModal('shareModal')" class="text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            </div>
            
            <div class="flex justify-between gap-4 mb-6 overflow-x-auto pb-2 no-scrollbar">
                <a href="#" id="shareWa" target="_blank" class="flex flex-col items-center gap-2 group min-w-[60px]"><div class="w-12 h-12 rounded-full bg-[#25D366]/20 flex items-center justify-center text-[#25D366] group-hover:bg-[#25D366] group-hover:text-white transition"><svg class="w-6 h-6 fill-current" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.628 1.213 2.827c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg></div><span class="text-[10px] text-gray-400">WhatsApp</span></a>
                <a href="#" id="shareFb" target="_blank" class="flex flex-col items-center gap-2 group min-w-[60px]"><div class="w-12 h-12 rounded-full bg-[#1877F2]/20 flex items-center justify-center text-[#1877F2] group-hover:bg-[#1877F2] group-hover:text-white transition"><svg class="w-6 h-6 fill-current" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.791-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg></div><span class="text-[10px] text-gray-400">Facebook</span></a>
                <a href="#" id="shareX" target="_blank" class="flex flex-col items-center gap-2 group min-w-[60px]"><div class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center text-white group-hover:bg-white group-hover:text-black transition"><svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></div><span class="text-[10px] text-gray-400">X</span></a>
            </div>

            <div class="relative bg-black rounded-lg p-2 flex items-center border border-gray-700">
                <input type="text" id="shareUrl" class="bg-transparent w-full text-xs text-gray-300 outline-none px-2" readonly value="{{ request.url }}">
                <button onclick="copyToClipboard()" class="bg-gray-800 hover:bg-gray-700 text-white text-xs font-bold px-4 py-1.5 rounded transition">Copiar</button>
            </div>
            <p id="copyFeedback" class="text-green-500 text-[10px] mt-2 h-4 opacity-0 transition">¬°Enlace copiado!</p>
        </div>
    </div>

    <div id="playlistModal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onclick="closeModal('playlistModal')"></div>
        <div class="relative bg-[#1A1A1A] border border-gray-700 rounded-2xl w-full max-w-sm p-6 shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-white">Guardar en...</h3>
                <button onclick="closeModal('playlistModal')" class="text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            </div>

            <div id="playlistContainer" class="space-y-2 mb-4 max-h-40 overflow-y-auto custom-scroll">
                <label class="flex items-center gap-3 p-2 hover:bg-white/5 rounded cursor-pointer group">
                    <input type="checkbox" class="w-4 h-4 rounded border-gray-600 bg-black text-green-500 focus:ring-green-500 focus:ring-offset-0">
                    <span class="text-sm text-gray-300 group-hover:text-white">Ver m√°s tarde</span>
                    <svg class="w-3 h-3 text-gray-500 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                </label>
            </div>

            <div class="border-t border-gray-700 pt-4 mt-2">
                <button id="btnToggleCreate" onclick="document.getElementById('createPlaylistForm').classList.toggle('hidden'); this.classList.toggle('hidden');" class="w-full py-2 flex items-center justify-center gap-2 text-sm font-bold text-gray-300 hover:text-white border border-dashed border-gray-600 hover:border-gray-400 rounded-lg transition">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                    Crear nueva lista
                </button>

                <div id="createPlaylistForm" class="hidden">
                    <label class="text-xs text-gray-500 mb-1 block">Nombre de la lista</label>
                    <div class="flex gap-2">
                        <input type="text" id="newPlaylistName" placeholder="Ej: Corridos 2025" class="bg-black border border-gray-600 rounded px-3 py-2 w-full text-sm text-white focus:border-green-500 outline-none">
                        <button onclick="createNewPlaylist()" class="bg-green-600 hover:bg-green-500 text-black font-bold px-3 rounded text-xs transition">CREAR</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === FAVORITOS ===
        function toggleFavorite(cursoId) {
            const btn = document.getElementById('favBtn');
            const icon = document.getElementById('favIcon');
            icon.classList.add('heart-anim');
            setTimeout(() => icon.classList.remove('heart-anim'), 300);
            
            fetch('/toggle-favorito', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ curso_id: cursoId })
            })
            .then(r => r.json())
            .then(data => {
                if (data.status === 'success') {
                    const isLiked = data.action === 'added';
                    btn.classList.toggle('text-red-500', isLiked);
                    btn.classList.toggle('bg-red-500/10', isLiked);
                    btn.classList.toggle('bg-[#1E1E1E]', !isLiked);
                    icon.classList.toggle('fill-current', isLiked);
                    icon.classList.toggle('fill-none', !isLiked);
                }
            });
        }

        // === MODALES ===
        function openModal(id) {
            document.getElementById(id).classList.remove('hidden');
            if(id === 'shareModal') {
                const url = encodeURIComponent(window.location.href);
                const text = encodeURIComponent("¬°Checa este curso en Muxicos!");
                document.getElementById('shareWa').href = `https://wa.me/?text=${text} ${url}`;
                document.getElementById('shareFb').href = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
                document.getElementById('shareX').href = `https://twitter.com/intent/tweet?url=${url}&text=${text}`;
            }
        }
        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
        }
        function copyToClipboard() {
            const copyText = document.getElementById("shareUrl");
            copyText.select();
            navigator.clipboard.writeText(copyText.value);
            const fb = document.getElementById('copyFeedback');
            fb.classList.remove('opacity-0');
            setTimeout(() => fb.classList.add('opacity-0'), 2000);
        }

        // === CREAR PLAYLIST (Simulaci√≥n JS) ===
        function createNewPlaylist() {
            const input = document.getElementById('newPlaylistName');
            const name = input.value.trim();
            if(!name) return;

            const container = document.getElementById('playlistContainer');
            const newRow = document.createElement('label');
            newRow.className = "flex items-center gap-3 p-2 hover:bg-white/5 rounded cursor-pointer group animate-pulse";
            newRow.innerHTML = `
                <input type="checkbox" checked class="w-4 h-4 rounded border-gray-600 bg-black text-green-500 focus:ring-green-500 focus:ring-offset-0">
                <span class="text-sm text-gray-300 group-hover:text-white">${name}</span>
            `;
            
            // Insertar al inicio
            container.insertBefore(newRow, container.firstChild);
            
            // Resetear formulario
            input.value = "";
            document.getElementById('createPlaylistForm').classList.add('hidden');
            document.getElementById('btnToggleCreate').classList.remove('hidden');
            
            // Quitar animaci√≥n despu√©s de un momento
            setTimeout(() => newRow.classList.remove('animate-pulse'), 1000);
        }
    </script>
</body>
</html>