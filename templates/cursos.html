<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muxicos - Explorar Cursos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .course-card { transition: all 0.3s ease; }
        .hide-text { display: none; }
        
        /* Estilo personalizado para el Select */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
        }
    </style>
</head>
<body class="bg-[#121212] text-white font-sans h-screen flex overflow-hidden">

    {% include 'sidebar.html' %}

    <main class="flex-1 overflow-y-auto bg-[#121212] p-8 no-scrollbar relative w-full">
        
        <header class="flex justify-between items-center mb-6 relative z-40">
            <div>
                <h2 class="text-3xl font-bold">Explorar Biblioteca</h2>
                <p class="text-gray-400 text-sm mt-1">Aprende los mejores requintos y adornos.</p>
            </div>
            
            {% include 'user_menu.html' %}
        </header>

        <div class="sticky top-0 z-30 bg-[#121212]/95 backdrop-blur-sm py-3 mb-6 border-b border-gray-800">
            <div class="flex flex-col md:flex-row gap-3 max-w-4xl">
                
                <div class="relative flex-grow">
                    <input type="text" id="searchInput" placeholder="Buscar canci√≥n, artista o t√©cnica..." 
                           class="w-full bg-[#1E1E1E] border border-gray-700 text-white pl-10 pr-4 py-2.5 rounded-lg text-sm focus:outline-none focus:border-green-500 focus:ring-1 focus:ring-green-500 transition placeholder-gray-500 shadow-sm">
                    <span class="absolute left-3 top-2.5 text-gray-500 text-base">üîç</span>
                </div>

                <div class="relative w-full md:w-56 flex-shrink-0">
                    <select id="instrumentFilter" class="w-full bg-[#1E1E1E] border border-gray-700 text-white pl-3 pr-8 py-2.5 rounded-lg text-sm focus:outline-none focus:border-green-500 cursor-pointer shadow-sm appearance-none truncate">
                        <option value="all">üé∏ Todos</option>
                        <option disabled>‚îÄ‚îÄ INSTRUMENTOS ‚îÄ‚îÄ</option>
                        <option value="guitarra">Guitarra / Docerola</option>
                        <option value="requinto">Requinto</option>
                        <option value="acordeon">Acorde√≥n</option>
                        <option value="bajo">Bajo Quinto / Sexto</option>
                        <option value="tololoche">Tololoche</option>
                        <option value="tuba">Tuba / Charcheta</option>
                        <option value="trompeta">Trompeta</option>
                        <option disabled>‚îÄ‚îÄ ESTILOS ‚îÄ‚îÄ</option>
                        <option value="tumbados">Corridos Tumbados</option>
                        <option value="sierre√±o">Sierre√±o</option>
                        <option value="norte√±o">Norte√±o</option>
                        <option value="banda">Banda</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="coursesGrid">
            
            {% if cursos %}
                {% for curso in cursos %}
                <a href="/curso/{{ curso[0] }}" 
                   class="course-card bg-[#181818] p-4 rounded-lg hover:bg-[#282828] transition cursor-pointer group flex flex-col h-full border border-transparent hover:border-gray-700 block"
                   data-title="{{ curso[1] | lower }}" 
                   data-maestro="{{ curso[5] | lower }}"
                   data-desc="{{ curso[4] | lower }}">
                    
                    <div class="h-36 bg-gray-700 rounded mb-4 overflow-hidden relative shadow-lg">
                        <img src="{{ curso[3] }}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500 opacity-90 group-hover:opacity-100" loading="lazy">
                        <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition duration-300 bg-black/40">
                            <div class="bg-green-500 text-black rounded-full p-2 shadow-lg transform scale-0 group-hover:scale-100 transition duration-300 delay-100">‚ñ∂</div>
                        </div>
                        
                        <div class="absolute top-2 right-2 flex gap-1">
                            {% if 'tumbado' in curso[1]|lower or 'natanael' in curso[1]|lower or 'peso pluma' in curso[1]|lower %}
                                <span class="bg-black/70 backdrop-blur-md text-white text-[9px] px-2 py-1 rounded border border-white/20">CT üëπ</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <h4 class="font-bold mb-1 text-sm line-clamp-2 leading-snug group-hover:text-green-400 transition">{{ curso[1] }}</h4>
                    <p class="text-xs text-gray-400 mt-1 mb-2 flex items-center gap-1">
                        <span>üë®‚Äçüè´</span> {{ curso[5] }}
                    </p>
                    <p class="hidden">{{ curso[4] }}</p>
                </a>
                {% endfor %}
            {% else %}
                <div class="col-span-full text-center py-20 text-gray-500">
                    <p>No hay cursos disponibles a√∫n. Visita el Admin Panel para agregar contenido.</p>
                </div>
            {% endif %}

        </div>

        <div id="noResults" class="hidden text-center py-20">
            <h3 class="text-xl font-bold text-gray-400">No encontramos resultados</h3>
            <p class="text-xs text-gray-600 mt-2">Intenta cambiar el filtro o la b√∫squeda.</p>
            <button onclick="resetFilters()" class="mt-4 text-green-500 text-sm hover:underline">Limpiar filtros</button>
        </div>

    </main>

    <script>
        const searchInput = document.getElementById('searchInput');
        const instrumentFilter = document.getElementById('instrumentFilter');
        const courseCards = document.querySelectorAll('.course-card');
        const noResults = document.getElementById('noResults');

        function filterCourses() {
            const searchTerm = searchInput.value.toLowerCase();
            const category = instrumentFilter.value.toLowerCase();
            
            let visibleCount = 0;

            courseCards.forEach(card => {
                const title = card.getAttribute('data-title');
                const maestro = card.getAttribute('data-maestro');
                const desc = card.getAttribute('data-desc');
                
                const fullText = (title + ' ' + desc + ' ' + maestro).normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                
                // 1. B√∫squeda Texto
                const matchesSearch = fullText.includes(searchTerm);
                
                // 2. Filtro Categor√≠a
                let matchesCategory = true;
                if (category !== 'all') {
                    if (category === 'guitarra') {
                        matchesCategory = fullText.includes('guitarra') || fullText.includes('docerola') || fullText.includes('requinto');
                    } else if (category === 'bajo') {
                        matchesCategory = fullText.includes('bajo') || fullText.includes('quinto') || fullText.includes('sexto');
                    } else if (category === 'tumbados') {
                        matchesCategory = fullText.includes('tumbado') || fullText.includes('natanael') || fullText.includes('peso pluma') || fullText.includes('junior h');
                    } else if (category === 'tuba') {
                        matchesCategory = fullText.includes('tuba') || fullText.includes('charcheta');
                    } else {
                        matchesCategory = fullText.includes(category);
                    }
                }

                if (matchesSearch && matchesCategory) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            noResults.style.display = visibleCount === 0 ? 'block' : 'none';
        }

        searchInput.addEventListener('input', filterCourses);
        instrumentFilter.addEventListener('change', filterCourses);

        function resetFilters() {
            searchInput.value = '';
            instrumentFilter.value = 'all';
            filterCourses();
        }
        
        filterCourses();
    </script>
</body>
</html>