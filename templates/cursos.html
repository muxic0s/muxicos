<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muxicos - Explorar Cursos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .course-card { transition: all 0.3s ease; }
        .hide-text { display: none; }
        /* Animaci√≥n Dropdown */
        .dropdown-enter { transform: translateY(-10px); opacity: 0; }
        .dropdown-enter-active { transform: translateY(0); opacity: 1; transition: all 0.2s ease; }
    </style>
</head>
<body class="bg-[#121212] text-white font-sans h-screen flex overflow-hidden">

    {% include 'sidebar.html' %}

    <main class="flex-1 overflow-y-auto bg-[#121212] p-8 no-scrollbar relative w-full">
        
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4 relative z-40">
            <div>
                <h2 class="text-3xl font-bold">Explorar Biblioteca</h2>
                <p class="text-gray-400 text-sm mt-1">Encuentra el curso perfecto para ti</p>
            </div>
            
            <div class="flex items-center gap-4 w-full md:w-auto">
                <div class="relative flex-1 md:w-96">
                    <input type="text" id="searchInput" placeholder="Buscar por t√≠tulo, maestro..." 
                           class="w-full bg-[#1E1E1E] border border-gray-700 text-white pl-10 p-3 rounded-full text-sm focus:outline-none focus:border-green-500 transition placeholder-gray-500">
                    <span class="absolute left-4 top-3.5 text-gray-500">üîç</span>
                </div>

                {% if usuario %}
                <div class="relative flex-shrink-0">
                    <button id="userMenuBtn" class="flex items-center gap-2 hover:bg-[#282828] p-1 pr-3 rounded-full transition group focus:outline-none">
                        {% if usuario.foto_url %}
                            <div class="w-9 h-9 rounded-full bg-cover bg-center border-2 border-transparent group-hover:border-white transition" style="background-image: url('{{ usuario.foto_url }}');"></div>
                        {% else %}
                            <div class="w-9 h-9 rounded-full bg-green-500 flex items-center justify-center text-black font-bold text-sm border-2 border-transparent group-hover:border-white transition">
                                {{ usuario.nombre[0] | upper }} 
                            </div>
                        {% endif %}
                        <svg class="w-3 h-3 text-gray-400 transition-transform duration-200" id="userMenuArrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>

                    <div id="userDropdown" class="hidden absolute right-0 mt-2 w-48 bg-[#1E1E1E] rounded-xl shadow-xl border border-gray-800 overflow-hidden z-50 transform origin-top-right transition-all duration-200">
                        <div class="px-4 py-3 border-b border-gray-700 bg-[#252525]">
                            <p class="text-sm text-white font-bold">{{ usuario.nombre }}</p>
                            <p class="text-[10px] text-gray-400 truncate">@{{ usuario.username }}</p>
                        </div>
                        <a href="/perfil" class="block px-4 py-2.5 text-sm text-gray-300 hover:bg-[#2A2A2A] hover:text-white transition flex items-center gap-2">
                            <span>üë§</span> Mi Perfil
                        </a>
                        <a href="#" class="block px-4 py-2.5 text-sm text-gray-300 hover:bg-[#2A2A2A] hover:text-white transition flex items-center gap-2">
                            <span>‚öôÔ∏è</span> Configuraci√≥n
                        </a>
                        <div class="border-t border-gray-700"></div>
                        <a href="/logout" class="block px-4 py-2.5 text-sm text-red-400 hover:bg-[#2A2A2A] hover:text-red-300 transition flex items-center gap-2">
                            <span>üö™</span> Cerrar Sesi√≥n
                        </a>
                    </div>
                </div>
                {% else %}
                    <div class="flex gap-2">
                        <a href="/login.html" class="text-sm font-bold text-gray-300 hover:text-white px-3 py-2">Log in</a>
                        <a href="/registro.html" class="text-sm font-bold bg-white text-black px-4 py-2 rounded-full hover:scale-105 transition">Sign up</a>
                    </div>
                {% endif %}
            </div>
        </header>

        <div class="flex flex-wrap gap-3 mb-8" id="filters">
            <button class="filter-btn active bg-white text-black px-4 py-1.5 rounded-full text-xs font-bold transition border border-white" data-filter="all">Todos</button>
            <button class="filter-btn bg-[#1E1E1E] hover:bg-[#333] text-gray-300 px-4 py-1.5 rounded-full text-xs font-bold transition border border-gray-700" data-filter="guitarra">Guitarra</button>
            <button class="filter-btn bg-[#1E1E1E] hover:bg-[#333] text-gray-300 px-4 py-1.5 rounded-full text-xs font-bold transition border border-gray-700" data-filter="acordeon">Acorde√≥n</button>
            <button class="filter-btn bg-[#1E1E1E] hover:bg-[#333] text-gray-300 px-4 py-1.5 rounded-full text-xs font-bold transition border border-gray-700" data-filter="tololoche">Tololoche</button>
            <button class="filter-btn bg-[#1E1E1E] hover:bg-[#333] text-gray-300 px-4 py-1.5 rounded-full text-xs font-bold transition border border-gray-700" data-filter="teoria">Teor√≠a</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="coursesGrid">
            
            {% if cursos %}
                {% for curso in cursos %}
                <a href="/curso/{{ curso[0] }}" 
                   class="course-card bg-[#181818] p-4 rounded-lg hover:bg-[#282828] transition cursor-pointer group flex flex-col h-full border border-transparent hover:border-gray-700 block"
                   data-title="{{ curso[1] | lower }}" 
                   data-maestro="{{ curso[5] | lower }}"
                   data-desc="{{ curso[4] | lower }}">
                    
                    <div class="h-40 bg-gray-700 rounded mb-4 overflow-hidden relative shadow-lg">
                        <img src="{{ curso[3] }}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500 opacity-90 group-hover:opacity-100" loading="lazy">
                        <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition duration-300 bg-black/40">
                            <div class="bg-green-500 text-black rounded-full p-3 shadow-lg transform scale-0 group-hover:scale-100 transition duration-300 delay-100">‚ñ∂</div>
                        </div>
                    </div>
                    
                    <h4 class="font-bold mb-1 text-sm line-clamp-2 leading-snug group-hover:text-green-400 transition">{{ curso[1] }}</h4>
                    <p class="text-xs text-gray-400 mt-1 mb-2 flex items-center gap-1">
                        <span>üë®‚Äçüè´</span> {{ curso[5] }}
                    </p>
                    <p class="text-[10px] text-gray-500 line-clamp-2 mt-auto">{{ curso[4] }}</p>
                </a>
                {% endfor %}
            {% else %}
                <div class="col-span-full text-center py-20 text-gray-500">
                    <p>No hay cursos disponibles a√∫n. Visita el Admin Panel para agregar contenido.</p>
                </div>
            {% endif %}

        </div>

        <div id="noResults" class="hidden text-center py-20">
            <h3 class="text-xl font-bold text-gray-400">No encontramos cursos</h3>
            <button onclick="resetFilters()" class="mt-4 text-green-500 text-sm hover:underline">Limpiar b√∫squeda</button>
        </div>

    </main>

    <script>
        // NOTA: El script del Sidebar Retr√°ctil se elimin√≥ de aqu√≠ 
        // porque ahora viene incluido dentro de 'sidebar.html'.

        // --- DROPDOWN DE USUARIO (Header) ---
        const userMenuBtn = document.getElementById('userMenuBtn');
        const userDropdown = document.getElementById('userDropdown');
        const arrow = document.getElementById('userMenuArrow');

        if (userMenuBtn) {
            userMenuBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                userDropdown.classList.toggle('hidden');
                if(userDropdown.classList.contains('hidden')){
                    arrow.style.transform = 'rotate(0deg)';
                } else {
                    arrow.style.transform = 'rotate(180deg)';
                }
            });
            document.addEventListener('click', (e) => {
                if (!userMenuBtn.contains(e.target) && !userDropdown.contains(e.target)) {
                    userDropdown.classList.add('hidden');
                    if(arrow) arrow.style.transform = 'rotate(0deg)';
                }
            });
        }

        // --- FILTROS Y B√öSQUEDA ---
        const searchInput = document.getElementById('searchInput');
        const courseCards = document.querySelectorAll('.course-card');
        const noResults = document.getElementById('noResults');
        const filterBtns = document.querySelectorAll('.filter-btn');

        function filterCourses() {
            const searchTerm = searchInput.value.toLowerCase();
            const activeBtn = document.querySelector('.filter-btn.active');
            const activeFilter = activeBtn ? activeBtn.getAttribute('data-filter') : 'all';
            let visibleCount = 0;

            courseCards.forEach(card => {
                const title = card.getAttribute('data-title');
                const maestro = card.getAttribute('data-maestro');
                const desc = card.getAttribute('data-desc');
                
                const matchesSearch = title.includes(searchTerm) || maestro.includes(searchTerm) || desc.includes(searchTerm);
                
                let matchesFilter = true;
                if (activeFilter !== 'all') {
                    const content = (title + ' ' + desc).normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                    matchesFilter = content.includes(activeFilter);
                }

                if (matchesSearch && matchesFilter) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            noResults.style.display = visibleCount === 0 ? 'block' : 'none';
        }

        searchInput.addEventListener('input', filterCourses);

        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => {
                    b.classList.remove('active', 'bg-white', 'text-black', 'border-white');
                    b.classList.add('bg-[#1E1E1E]', 'text-gray-300', 'border-gray-700');
                });
                btn.classList.add('active', 'bg-white', 'text-black', 'border-white');
                btn.classList.remove('bg-[#1E1E1E]', 'text-gray-300', 'border-gray-700');
                filterCourses();
            });
        });

        // Funci√≥n auxiliar por si queremos activarlo externamente (opcional)
        window.activateSidebarFilter = function(filterName) {
            const btn = document.querySelector(`.filter-btn[data-filter="${filterName}"]`);
            if(btn) btn.click();
        }

        function resetFilters() { searchInput.value = ''; filterBtns[0].click(); }
    </script>
</body>
</html>